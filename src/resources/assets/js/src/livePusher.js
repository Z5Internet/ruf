"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};module.exports=function(){var t=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},i=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":_typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":_typeof(e))&&"function"!=typeof e?t:e},s=function(){function i(e){t(this,i),this._defaultOptions={auth:{headers:{}},authEndpoint:"/broadcasting/auth",host:"http://127.0.0.1:6001",path:"/livePusher",key:null,namespace:"App.Events",authChannel:function(t,e){alert("Need to do this")}},this.setOptions(e),this.connect()}return e(i,[{key:"setOptions",value:function(t){return this.options=n(this._defaultOptions,t),t}}]),i}(),r=function(){function n(){t(this,n)}return e(n,[{key:"notification",value:function(t){return this.listen(".Illuminate\\Notifications\\Events\\BroadcastNotificationCreated",t)}},{key:"listenForWhisper",value:function(t,e){return this.listen(".client-"+t,e)}}]),n}(),c=function(){function n(e){t(this,n),this.setNamespace(e)}return e(n,[{key:"format",value:function(t){return"."===t.charAt(0)||"\\"===t.charAt(0)?t.substr(1):(this.namespace&&(t=this.namespace+"."+t),t.replace(/\./g,"\\"))}},{key:"setNamespace",value:function(t){this.namespace=t}}]),n}(),u=function(n){function s(e,n,i){t(this,s);var r=o(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));return r.events={},r.name=n,r.socket=e,r.options=i,r.eventFormatter=new c(r.options.namespace),r.subscribe(),r.configureReconnector(),r}return i(s,n),e(s,[{key:"subscribe",value:function(){var t=this,e=this,n=this.t=(new Date).getTime();e.socket.id?this.emitSubscribe():this.socket.on("connect",function(e){n==t.t&&t.emitSubscribe()})}},{key:"emitSubscribe",value:function(){var t=this;t.options.authPrivate(t.socket.id,t.name).then(function(e){e&&t.socket.emit("subscribe",{channel:t.name,appId:t.options.appId,authHash:e,auth:t.options.auth||{}})})}},{key:"unsubscribe",value:function(){this.unbind(),this.socket.emit("unsubscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"listen",value:function(t,e){return this.on(this.eventFormatter.format(t),e),this}},{key:"on",value:function(t,e){var n=this,i=function(t,i){n.name==t&&e(i)};this.socket.on(t,i),this.bind(t,i)}},{key:"configureReconnector",value:function(){var t=this,e=function(){t.subscribe()};this.socket.on("reconnect",e),this.bind("reconnect",e)}},{key:"bind",value:function(t,e){this.events[t]=this.events[t]||[],this.events[t].push(e)}},{key:"unbind",value:function(){var t=this;Object.keys(this.events).forEach(function(e){t.events[e].forEach(function(n){t.socket.removeListener(e,n)}),delete t.events[e]})}}]),s}(r),a=function(n){function s(){return t(this,s),o(this,(s.__proto__||Object.getPrototypeOf(s)).apply(this,arguments))}return i(s,n),e(s,[{key:"whisper",value:function(t,e){return this.socket.emit("client event",{channel:this.name,event:"client-"+t,data:e}),this}}]),s}(u),h=function(n){function s(){return t(this,s),o(this,(s.__proto__||Object.getPrototypeOf(s)).apply(this,arguments))}return i(s,n),e(s,[{key:"here",value:function(t){return this.on("presence:subscribed",function(e){t(e.map(function(t){return t.user_info}))}),this}},{key:"joining",value:function(t){return this.on("presence:joining",function(e){return t(e.user_info)}),this}},{key:"leaving",value:function(t){return this.on("presence:leaving",function(e){return t(e.user_info)}),this}}]),s}(a),l=function(n){function s(){var e;t(this,s);for(var n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];var c=o(this,(e=s.__proto__||Object.getPrototypeOf(s)).call.apply(e,[this].concat(i)));return c.channels={},c}return i(s,n),e(s,[{key:"connect",value:function(){return this.socket=io(this.options.host,this.options),this.socket}},{key:"listen",value:function(t,e,n){return this.channel(t).listen(e,n)}},{key:"channel",value:function(t){return this.channels[t]||(this.channels[t]=new u(this.socket,t,this.options)),this.channels[t]}},{key:"privateChannel",value:function(t){return this.channels["private-"+t]||(this.channels["private-"+t]=new a(this.socket,"private-"+t,this.options)),this.channels["private-"+t]}},{key:"presenceChannel",value:function(t){return this.channels["presence-"+t]||(this.channels["presence-"+t]=new h(this.socket,"presence-"+t,this.options)),this.channels["presence-"+t]}},{key:"leave",value:function(t){var e=this;[t,"private-"+t,"presence-"+t].forEach(function(t){e.channels[t]&&(e.channels[t].unsubscribe(),delete e.channels[t])})}},{key:"socketId",value:function(){return this.socket.id}},{key:"disconnect",value:function(){this.socket.disconnect()}}]),s}(s);return function(){function n(e){t(this,n),this.options=e,this.connector=new l(this.options)}return e(n,[{key:"channel",value:function(t){return this.connector.channel(t)}},{key:"private",value:function(t){return t=this.options.appId+"-"+t,this.connector.privateChannel(t)}},{key:"join",value:function(t){return t=this.options.appId+"-"+t,this.connector.presenceChannel(t)}},{key:"listen",value:function(t,e){return this.connector.listen(t,e)}},{key:"leave",value:function(t){this.connector.leave(t)}},{key:"socketId",value:function(){return this.connector.socketId()}},{key:"disconnect",value:function(){this.connector.disconnect()}}]),n}()}();